/*! tabella - v0.0.1 - 2015-01-07
* https://github.com/iliketomatoes/tabellajs
* Copyright (c) 2015 ; Licensed  */
!function(a){"use strict";"function"==typeof define&&define.amd?define(a):window.Tabella=a()}(function(){"use strict";function a(a){return new RegExp("(^|\\s+)"+a+"(\\s+|$)")}function b(a,b){var c=p(a,b)?r:q;c(a,b)}function c(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a}function d(){for(var a="transform WebkitTransform MozTransform OTransform msTransform".split(" "),b=0;b<a.length;b++)if(void 0!==document.createElement("div").style[a[b]])return a[b];return!1}function e(a,b,c,d){var e=document.createElement(a);return e.className=b,d&&(e.innerHTML=d),c.appendChild(e),e}function f(a){return Array.prototype.slice.call(a,0)}function g(a,b,c){for(var d=b.split(" "),e=d.length;e--;)a.addEventListener(d[e],c,!1)}function h(a){this.value=a,this.message="Tabella.js error: ",this.toString=function(){return this.message+this.value}}function i(a){this.easeing=w.hasOwnProperty(a)?w[a]:w.easeInOutSine,this.animated=!1}function j(a,b){return k(a[0],a[1],a[2],a[3],b)}function k(a,b,c,d,e){var f=function(b){var d=1-b;return 3*d*d*b*a+3*d*b*b*c+b*b*b},g=function(a){var c=1-a;return 3*c*c*a*b+3*c*a*a*d+a*a*a},h=function(b){var d=1-b;return 3*(2*(b-1)*b+d*d)*a+3*(-b*b*b+2*d*b)*c};return function(a){var b,c,d,i,j,k,l=a;for(d=l,k=0;8>k;k++){if(i=f(d)-l,Math.abs(i)<e)return g(d);if(j=h(d),Math.abs(j)<1e-6)break;d-=i/j}if(b=0,c=1,d=l,b>d)return g(b);if(d>c)return g(c);for(;c>b;){if(i=f(d),Math.abs(i-l)<e)return g(d);l>i?b=d:c=d,d=.5*(c-b)+b}return g(d)}}function l(a,b){var c=b||null,d=Array.prototype.slice.call(arguments,2);return a.apply(c,d)}function m(){this.points={cachedX:null,cachedY:null,currX:null,currY:null},this.touchStarted=!1}function n(a,b){this.options=a,this.el=b}function o(a,b){if(this.defaults={periods:null,rows:null,cellBreakpoints:{"default":[0,1],small:[360,2],medium:[640,3],large:[820,4],xlarge:[1080,5]},descBreakpoints:{"default":[0,0],medium:[460,160],large:[900,200]},from:"from",to:"to",currency:"&euro;",arrowLeft:"←",arrowRight:"→",easing:"easeInOutSine",duration:600},this.periodRow=null,this.arrows=null,this.pointer=0,this.animator=null,this.currentBreakpoint={},this.currentCellWidth=0,this.el=a,"undefined"==typeof a)throw new h("You did not pass a valid target element to the constructor");if("undefined"==typeof b)throw new h("You did not pass any options to the constructor");this.options=c(this.defaults,b);var d=this;if(null===d.options.periods||null===d.options.rows)throw new h("Periods or rows are null");var e=new n(d.options,d.el);if(d.periodRow=e.setUpPeriods(),!d.periodRow)throw new h("Periods is not an Array");if(!e.setUpRows())throw new h("There is a mismatch between periods and prices cells");d.arrows=e.setUpArrows(d.periodRow);var f=function(a,b,c){var e,f=d;return function(){var d=arguments,g=function(){e=null,c||a.apply(f,d)},h=c&&!e;clearTimeout(e),e=setTimeout(g,b),h&&a.apply(f,d)}},j=function(){d.currentBreakpoint=d.getBreakpoint(),d.currentCellWidth=d.getCellWidth(d.currentBreakpoint),d.refreshSize()};window.addEventListener("load",f(j,50)),window.addEventListener("resize",f(d.refreshSize,250)),d.animator=new i(d.options.easing),d.toucher=new m,d.arrows.arrowLeft.addEventListener("click",function(){d.move("left")}),d.arrows.arrowRight.addEventListener("click",function(){d.move("right")}),g(d.periodRow,d.toucher.touchEvents.start,function(a){a.preventDefault(),console.log(d.toucher.onTouchStart(a))}),g(d.periodRow,d.toucher.touchEvents.move,function(a){a.preventDefault(),console.log(d.toucher.onTouchMove(a))}),g(d.periodRow,d.toucher.touchEvents.end,function(a){a.preventDefault(),console.log(d.toucher.onTouchEnd(a))})}var p,q,r;"classList"in document.documentElement?(p=function(a,b){return a.classList.contains(b)},q=function(a,b){a.classList.add(b)},r=function(a,b){a.classList.remove(b)}):(p=function(b,c){return a(c).test(b.className)},q=function(a,b){p(a,b)||(a.className=a.className+" "+b)},r=function(b,c){b.className=b.className.replace(a(c)," ")});var s={hasClass:p,addClass:q,removeClass:r,toggleClass:b,has:p,add:q,remove:r,toggle:b},t=d(),u=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.oRequestAnimationFrame,v=window.cancelAnimationFrame||window.mozCancelAnimationFrame,w={easeInSine:[.47,0,.745,.715],easeOutSine:[.39,.575,.565,1],easeInOutSine:[.445,.05,.55,.95],easeInQuad:[.55,.085,.68,.53],easeOutQuad:[.25,.46,.45,.94],easeInOutQuad:[.455,.03,.515,.955],easeInCubic:[.55,.055,.675,.19],easeOutCubic:[.215,.61,.355,1],easeInOutCubic:[.645,.045,.355,1],easeInQuart:[.895,.03,.685,.22],easeOutQuart:[.165,.84,.44,1],easeInOutQuart:[.77,0,.175,1],easeInQuint:[.755,.05,.855,.06],easeOutQuint:[.23,1,.32,1],easeInOutQuint:[.86,0,.07,1],easeInExpo:[.95,.05,.795,.035],easeOutExpo:[.19,1,.22,1],easeInOutExpo:[1,0,0,1],easeInCirc:[.6,.04,.98,.335],easeOutCirc:[.075,.82,.165,1],easeInOutCirc:[.785,.135,.15,.86],easeInBack:[.6,-.28,.735,.045],easeOutBack:[.175,.885,.32,1.275],easeInOutBack:[.68,-.55,.265,1.55]};i.prototype.getAnimationCurve=function(a){var b=this,c=1e3/60/a/4;return j(b.easeing,c)},i.prototype.oldAnimation=function(a,b,c,d,e){var f=this,g=e-b,h=null,i=setInterval(function(){null===h&&(h=new Date);var b=new Date-h,j=b/c;j>=1&&(j=1);var k=d(j).toFixed(2);f.step(a,k,e,g),1===j&&(clearInterval(i),h=null)},25)},i.prototype.modernAnimation=function(a,b,c,d,e){function f(b){null===j&&(j=b);var k=b-j,l=k/c;l>=1&&(l=1);var m=d(l).toFixed(2);h.step(a,m,e,i),1===l?(v(g),j=null):u(f)}var g,h=this,i=e-b,j=null;g=u(f)},i.prototype.step=function(a,b,c,d){this.offset(a,parseInt(c)+parseInt((d-c)*b))},i.prototype.offset=function(a,b){if("undefined"==typeof b){if(t){var c=a.style[t]?a.style[t].match(/-?\d+/g)[0]:0;return c}return a.style.left}t?a.style[t]="translate("+b+"px, 0px)":a.style.left=b+"px"},i.prototype.actualAnimation=u&&v?i.prototype.modernAnimation:i.prototype.oldAnimation,i.prototype.animate=function(a,b,c){var d=this,e=c||5;if(d.animated)return!1;d.animated=!0;var f=d.getAnimationCurve(e);a.forEach(function(a){d.actualAnimation(a,b,e,f,d.offset(a))}),d.animated=!1},i.prototype.reset=function(a,b){var c=this;if(c.animated)return!1;c.animated=!0;var d=c.getAnimationCurve(b);a.forEach(function(a){c.actualAnimation(a,0,b,d,0)}),c.animated=!1};var x=(!!navigator.pointerEnabled||navigator.msPointerEnabled,function(a){var b=a.toLowerCase(),c="MS"+a;return navigator.msPointerEnabled?c:b});return m.prototype.touchEvents={start:x("PointerDown")+" touchstart mousedown",end:x("PointerUp")+" touchend mouseup",move:x("PointerMove")+" touchmove mousemove"},m.prototype.getPointerEvent=function(a){return a.targetTouches?a.targetTouches[0]:a},m.prototype.onTouchStart=function(a,b,c){var d=this,e=d.getPointerEvent(a);return d.points.cachedX=d.points.currX=e.pageX,d.points.cachedY=d.points.currY=e.pageY,d.touchStarted=!0,"function"==typeof callback&&l(b,c),d.points},m.prototype.onTouchEnd=function(a,b,c){var d=this,e=d.points.cachedY-d.points.currY,f=d.points.cachedX-d.points.currX;return d.touchStarted=!1,"function"==typeof b&&l(b,c),{deltaX:f,deltaY:e}},m.prototype.onTouchMove=function(a,b,c){var d=this;if(d.touchStarted===!1)return!1;var e=d.getPointerEvent(a);return d.points.currX=e.pageX,d.points.currY=e.pageY,"function"==typeof b&&l(b,c),d.points},n.prototype.setUpPeriods=function(){var a=this,b=a.options.periods,c=document.createDocumentFragment();if(b instanceof Array&&b.length){var d=b.length,f=e("div","t-row",c),g=e("div","t-row-content-wrapper",f),h=e("div","t-row-content",g),i='<div class="t-element">';i+='<div class="t-cell-desc-l">',i+=a.options.from,i+="<br>",i+=a.options.to,i+="</div>",i+="</div>";for(var j=(e("div","t-row-desc",h,i),e("div","t-row-values",h)),k=e("div","t-sliding-row",j),l=0;d>l;l++){var m=document.createElement("div");m.className="t-row-cell";var n='<div class="t-cell-desc-s">';n+=a.options.from,"undefined"!=typeof b[l][1]&&(n+="<br>",n+=a.options.to),n+="</div>",n+='<div class="t-cell-value t-bold">',n+="undefined"!=typeof b[l][0]?b[l][0]:"not set","undefined"!=typeof b[l][1]&&(n+="<br>",n+=b[l][1]),n+="</div>";{e("div","t-element",m,n)}k.appendChild(m)}return a.el.appendChild(c),f}return!1},n.prototype.setUpRows=function(){var a=this,b=a.options.periods,c=a.options.rows,d=b.length,f=c.length,g=document.createDocumentFragment();if(f>0){for(var h=!0,i=0;f>i&&h;i++){var j=e("div","t-row",g);if(c[i].desc){e("section","t-row-header",j,c[i].desc)}if(c[i].prices)for(var k=0;k<c[i].prices.length;k++){var l=e("div","t-row-content-wrapper",j),m=e("div","t-row-content",l);if(!h)break;var n='<div class="t-element">';n+='<div class="t-cell-desc-l">',n+=c[i].pricesDesc[k],n+="</div>",n+="</div>";var o="t-row-desc";k>=1&&(o+=" t-cell-border-top");for(var p=(e("div",o,m,n),e("div","t-row-values",m)),q=e("div","t-sliding-row",p),r=0;r<c[i].prices[k].length;r++){if(c[i].prices[k].length!==d){h=!1;break}var s=document.createElement("div"),t="t-row-cell";k>=1&&(t+=" t-cell-border-top"),s.className=t;var u="";c[i].pricesDesc[k]&&(u+='<div class="t-cell-desc-s">',c[i].pricesDesc[k][r]?u+=c[i].pricesDesc[k][r]:c[i].pricesDesc[k][0]&&(u+=c[i].pricesDesc[k][0]),u+="</div>"),u+='<div class="t-cell-value">',u+="undefined"!=typeof c[i].prices[k][r]?c[i].prices[k][r]:"not set",u+=" "+a.options.currency,u+="</div>";{e("div","t-element",s,u)}q.appendChild(s)}}}return a.el.appendChild(g),h}return!1},n.prototype.setUpArrows=function(a){var b=this,c=e("div","t-arr-right t-hide",a,b.options.arrowRight),d=e("div","t-arr-left t-hide",a,b.options.arrowLeft);return{arrowRight:c,arrowLeft:d}},n.prototype.attachEvents=function(){},o.prototype.refreshSize=function(){var a=this,b=a.currentBreakpoint,c=a.currentBreakpoint=a.getBreakpoint(),d=a.currentCellWidth,e=a.currentCellWidth=a.getCellWidth(c),g=c.descBreakpoint[1],h=a.options.periods.length;a.refreshArrowPosition(g);var i=f(a.el.querySelectorAll(".t-row"));i.forEach(function(a){var b=f(a.querySelectorAll(".t-row-content"));b.forEach(c.descBreakpoint[1]>0?function(a){a.style.width=g+h*e+"px";var b=a.querySelector(".t-row-desc");b.style.width=g+"px",s.remove(b,"t-hide"),f(a.querySelectorAll(".t-row-cell")).forEach(function(a){a.style.width=e+"px"}),f(a.querySelectorAll(".t-cell-desc-s")).forEach(function(a){s.add(a,"t-hide")})}:function(a){a.style.width=h*e+"px",s.add(a.querySelector(".t-row-desc"),"t-hide"),f(a.querySelectorAll(".t-row-cell")).forEach(function(a){a.style.width=e+"px"}),f(a.querySelectorAll(".t-cell-desc-s")).forEach(function(a){s.remove(a,"t-hide")})})}),a.pointer>0&&(b.cellBreakpoint[0]!=c.cellBreakpoint[0]||b.descBreakpoint[1]!=c.descBreakpoint[1]?a.move():d!=e&&a.move(parseInt(e-d)*parseInt(a.pointer)))},o.prototype.getCellWidth=function(a){var b,c=this,d=c.options.periods.length,e=a.cellBreakpoint,f=a.descBreakpoint;return b=e[1]>d?(c.el.clientWidth-f[1])/d:(c.el.clientWidth-f[1])/e[1],Math.round(b)},o.prototype.getBreakpoint=function(){var a=this,b=0,c=a.el.clientWidth,d=a.options.cellBreakpoints,e=a.options.descBreakpoints,f=[0,1],g=[0,0];for(var h in d){var i=d[h][0];"number"==typeof i&&i>0&&c>=i&&Math.abs(c-i)<Math.abs(c-b)&&(b=i,f=d[h])}b=0;for(var j in e){var k=e[j][0];"number"==typeof k&&k>0&&c>=k&&Math.abs(c-k)<Math.abs(c-b)&&(b=k,g=e[j])}return{cellBreakpoint:f,descBreakpoint:g}},o.prototype.refreshArrowPosition=function(a){var b=this,c=a||b.currentBreakpoint.descBreakpoint[1];b.arrows.arrowLeft.style.left=c+"px",b.updateArrows()},o.prototype.updateArrows=function(){var a=this,b=a.currentBreakpoint||a.getBreakpoint(),c=a.options.periods.length;c>b.cellBreakpoint[1]?0===a.pointer?(s.add(a.arrows.arrowLeft,"t-hide"),s.remove(a.arrows.arrowRight,"t-hide")):a.pointer===c-b.cellBreakpoint[1]?(s.remove(a.arrows.arrowLeft,"t-hide"),s.add(a.arrows.arrowRight,"t-hide")):(s.remove(a.arrows.arrowLeft,"t-hide"),s.remove(a.arrows.arrowRight,"t-hide")):(s.add(a.arrows.arrowLeft,"t-hide"),s.add(a.arrows.arrowRight,"t-hide"))},o.prototype.move=function(a){var b=this,c=b.getCellWidth(b.currentBreakpoint),d=(b.options.periods.length,f(b.el.querySelectorAll(".t-sliding-row")));"right"===a?(b.animator.animate(d,c,b.options.duration),b.pointer++):"left"===a?(b.animator.animate(d,-c,b.options.duration),b.pointer--):"number"==typeof a?b.animator.animate(d,a,251):(b.animator.reset(d,b.options.duration),b.pointer=0),b.updateArrows()},o});