/*! tabella - v0.0.1 - 2014-12-24
* https://github.com/iliketomatoes/tabellajs
* Copyright (c) 2014 ; Licensed  */
!function(a){"use strict";"function"==typeof define&&define.amd?define(a):window.Tabella=a()}(function(){"use strict";function a(a){return new RegExp("(^|\\s+)"+a+"(\\s+|$)")}function b(a,b){var c=i(a,b)?k:j;c(a,b)}function c(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a}function d(a,b,c,d){var e=document.createElement(a);return e.className=b,d&&(e.innerHTML=d),c.appendChild(e),e}function e(a){return Array.prototype.slice.call(a,0)}function f(a){this.value=a,this.message="Tabella.js error: ",this.toString=function(){return this.message+this.value}}function g(a,b){this.options=a,this.el=b}function h(a,b){if(this.defaults={periods:null,rows:null,cellBreakpoints:{"default":[0,1],small:[360,2],medium:[640,3],large:[820,4],xlarge:[1080,5]},descBreakpoints:{"default":[0,0],medium:[460,160],large:[900,200]},from:"from",to:"to",borderWidth:1,currency:"&euro;",arrowLeft:"←",arrowRight:"→"},this.periodRow=null,this.arrows=null,this.currentBreakpoint={},this.cellWidth=0,this.el=a,"undefined"==typeof a)throw new f("You did not pass a valid target element to the constructor");if("undefined"==typeof b)throw new f("You did not pass any options to the constructor");this.options=c(this.defaults,b);var d=this;if(null===d.options.periods||null===d.options.rows)throw new f("Periods or rows are null");var e=new g(d.options,d.el);if(d.periodRow=e.setUpPeriods(),!d.periodRow)throw new f("Periods is not an Array");if(!e.setUpRows())throw new f("There is a mismatch between periods and prices cells");d.arrows=e.setUpArrows(d.periodRow);var h=function(a,b,c){var e,f=d;return function(){var d=arguments,g=function(){e=null,c||a.apply(f,d)},h=c&&!e;clearTimeout(e),e=setTimeout(g,b),h&&a.apply(f,d)}};window.addEventListener("resize",h(d.refreshSize,250)),window.addEventListener("load",h(d.refreshSize,50))}var i,j,k;"classList"in document.documentElement?(i=function(a,b){return a.classList.contains(b)},j=function(a,b){a.classList.add(b)},k=function(a,b){a.classList.remove(b)}):(i=function(b,c){return a(c).test(b.className)},j=function(a,b){i(a,b)||(a.className=a.className+" "+b)},k=function(b,c){b.className=b.className.replace(a(c)," ")});var l={hasClass:i,addClass:j,removeClass:k,toggleClass:b,has:i,add:j,remove:k,toggle:b};return g.prototype.setUpPeriods=function(){var a=this,b=a.options.periods,c=document.createDocumentFragment();if(b instanceof Array&&b.length){var e=b.length,f=d("div","t-row",c),g=d("div","t-row-content-wrapper",f),h=d("div","t-row-content",g),i='<div class="t-element">';i+='<div class="t-cell-desc-l">',i+=a.options.from,i+="<br>",i+=a.options.to,i+="</div>",i+="</div>";for(var j=(d("div","t-row-desc",h,i),d("div","t-row-values",h)),k=0;e>k;k++){var l=document.createElement("div");l.className="t-row-cell";var m='<div class="t-cell-desc-s">';m+=a.options.from,"undefined"!=typeof b[k][1]&&(m+="<br>",m+=a.options.to),m+="</div>",m+='<div class="t-cell-value t-bold">',m+="undefined"!=typeof b[k][0]?b[k][0]:"not set","undefined"!=typeof b[k][1]&&(m+="<br>",m+=b[k][1]),m+="</div>";{d("div","t-element",l,m)}j.appendChild(l)}return a.el.appendChild(c),f}return!1},g.prototype.setUpRows=function(){var a=this,b=a.options.periods,c=a.options.rows,e=b.length,f=c.length,g=document.createDocumentFragment();if(f>0){for(var h=!0,i=0;f>i&&h;i++){var j=d("div","t-row",g);if(c[i].desc){d("section","t-row-header",j,c[i].desc)}if(c[i].prices)for(var k=0;k<c[i].prices.length;k++){var l=d("div","t-row-content-wrapper",j),m=d("div","t-row-content",l);if(!h)break;var n='<div class="t-element">';n+='<div class="t-cell-desc-l">',n+=c[i].pricesDesc[k],n+="</div>",n+="</div>";var o="t-row-desc";k>=1&&(o+=" t-cell-border-top");for(var p=(d("div",o,m,n),d("div","t-row-values",m)),q=0;q<c[i].prices[k].length;q++){if(c[i].prices[k].length!==e){h=!1;break}var r=document.createElement("div"),s="t-row-cell";k>=1&&(s+=" t-cell-border-top"),r.className=s;var t="";c[i].pricesDesc[k]&&(t+='<div class="t-cell-desc-s">',c[i].pricesDesc[k][q]?t+=c[i].pricesDesc[k][q]:c[i].pricesDesc[k][0]&&(t+=c[i].pricesDesc[k][0]),t+="</div>"),t+='<div class="t-cell-value">',t+="undefined"!=typeof c[i].prices[k][q]?c[i].prices[k][q]:"not set",t+=" "+a.options.currency,t+="</div>";{d("div","t-element",r,t)}p.appendChild(r)}}}return a.el.appendChild(g),h}return!1},g.prototype.setUpArrows=function(a){var b=this,c=d("div","t-arr-right t-hide",a,b.options.arrowRight),e=d("div","t-arr-left t-hide",a,b.options.arrowLeft);return{arrowRight:c,arrowLeft:e}},g.prototype.attachEvents=function(){},h.prototype.refreshSize=function(){var a=this,b=a.getBreakpoint(),c=a.getCellWidth(b),d=b.descBreakpoint[1],f=a.options.periods.length;a.refreshArrowPosition({cellWidth:c,breakpoint:b,descWidth:d,numberOfPeriods:f});var g=e(a.el.querySelectorAll(".t-row"));g.forEach(function(a){var g=e(a.querySelectorAll(".t-row-content"));g.forEach(b.descBreakpoint[1]>0?function(a){a.style.width=d+f*c+"px";var b=a.querySelector(".t-row-desc");b.style.width=d+"px",l.remove(b,"t-hide"),e(a.querySelectorAll(".t-row-cell")).forEach(function(a){a.style.width=c+"px"}),e(a.querySelectorAll(".t-cell-desc-s")).forEach(function(a){l.add(a,"t-hide")})}:function(a){a.style.width=f*c+"px",l.add(a.querySelector(".t-row-desc"),"t-hide"),e(a.querySelectorAll(".t-row-cell")).forEach(function(a){a.style.width=c+"px"}),e(a.querySelectorAll(".t-cell-desc-s")).forEach(function(a){l.remove(a,"t-hide")})})})},h.prototype.getCellWidth=function(a){var b,c=this,d=c.options.periods.length,e=a.cellBreakpoint,f=a.descBreakpoint;return b=e[1]>d?(c.el.clientWidth-f[1])/d:(c.el.clientWidth-f[1])/e[1],Math.round(b)},h.prototype.getBreakpoint=function(){var a=this,b=0,c=a.el.clientWidth,d=a.options.cellBreakpoints,e=a.options.descBreakpoints,f=[0,1],g=[0,0];for(var h in d){var i=d[h][0];"number"==typeof i&&i>0&&c>=i&&Math.abs(c-i)<Math.abs(c-b)&&(b=i,f=d[h])}b=0;for(var j in e){var k=e[j][0];"number"==typeof k&&k>0&&c>=k&&Math.abs(c-k)<Math.abs(c-b)&&(b=k,g=e[j])}return{cellBreakpoint:f,descBreakpoint:g}},h.prototype.refreshArrowPosition=function(a){var b=this,c=a.breakpoint||b.getBreakpoint(),d=(a.cellWidth||b.getCellWidth(c),a.descWidth||c.descBreakpoint[1]),e=a.numberOfPeriods||b.options.periods.length;b.arrows.arrowLeft.style.left=d+"px",e>c.cellBreakpoint[1]?(l.remove(b.arrows.arrowLeft,"t-hide"),l.remove(b.arrows.arrowRight,"t-hide")):(l.add(b.arrows.arrowLeft,"t-hide"),l.add(b.arrows.arrowRight,"t-hide"))},h});